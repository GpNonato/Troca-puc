<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile</title>
    <link rel="icon" type="image/png" th:href="@{/images/logo.png}">
    <link rel="stylesheet" th:href="@{/css/general.css}">
    <!-- Adicionando o Chart.js para gerar os gráficos -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <div class="container">
        <nav>
            <ul>
                <li>
                    <a id="notification-a">
                        <img th:src="@{/images/notification.png}" alt="Notification" id="notification-img"
                            class="nav-icon">
                    </a>
                </li>
                <div class="notification-choice" style="display: none;">
                    <ul>
                        <li>
                            <a th:href="@{/notification/sent}">
                                <img th:src="@{/images/sent.png}" alt="Sent" class="nav-icon choice">
                            </a>
                        </li>
                        <li>
                            <a th:href="@{/notification/received}">
                                <img th:src="@{/images/received.png}" alt="Received" class="nav-icon choice">
                            </a>
                        </li>
                    </ul>
                </div>
                <li>
                    <a id="market-a">
                        <img th:src="@{/images/market.png}" alt="Market" id="market-img" class="nav-icon">
                    </a>
                </li>
                <div class="market-choice" style="display: none;">
                    <ul>
                        <li>
                            <a th:href="@{/market/personal}">
                                <img th:src="@{/images/profile.png}" alt="Personal" class="nav-icon choice">
                            </a>
                        </li>
                        <li>
                            <a th:href="@{/market/all}">
                                <img th:src="@{/images/group.png}" alt="All" class="nav-icon choice">
                            </a>
                        </li>
                    </ul>
                </div>
                <li>
                    <a th:href="@{/search}">
                        <img th:src="@{/images/search.png}" alt="Search" class="nav-icon">
                    </a>
                </li>
                <li>
                    <a th:href="@{/profile}" class="active">
                        <img th:src="@{/images/profile.png}" alt="Profile" class="nav-icon active">
                    </a>
                </li>
            </ul>
        </nav>

        <header>
            <h2>Admin</h2>
        </header>

        <main class="main-profile">
            <div class="admin-header">
                <a href="/profile">Go back</a>
            </div>

            <!-- Seção de Estatísticas -->
            <section class="statistics">
                <h3>Estatísticas</h3>
                <div class="statistics-cards">
                    <div class="statistics-card">
                        <h4>Total de Propostas</h4>
                        <p th:text="${totalProposals}"></p>
                    </div>
                    <div class="statistics-card">
                        <h4>Propostas Aceitas</h4>
                        <p th:text="${acceptedProposals}"></p>
                    </div>
                    <div class="statistics-card">
                        <h4>Propostas Recusadas</h4>
                        <p th:text="${refusedProposals}"></p>
                    </div>
                    <div class="statistics-card">
                        <h4>Propostas Pendentes</h4>
                        <p th:text="${pendingProposals}"></p>
                    </div>
                </div>
            
                <!-- Seção para o gráfico -->
                <div class="statistics-chart">
                    <canvas id="proposalChart" width="400" height="200"></canvas>
                </div>
            </section>

            <!-- Exibir lista de propostas -->
            <section class="proposals">
                <h3>Propostas</h3>
                <div th:each="proposal : ${proposals}">
                    <div class="proposal-item">
                        <p><strong>Item:</strong> <span th:text="${proposal.item.name}"></span></p>
                        <p><strong>Status:</strong> <span th:text="${proposal.status}"></span></p>
                        <p><strong>Preço Oferecido:</strong> <span th:text="${proposal.price}"></span></p>
                        <p><strong>Descrição:</strong> <span th:text="${proposal.description}"></span></p>
                        
                        <p><strong>Telefone do Dono:</strong> <span th:text="${proposal.oTelefone}"></span></p>
                        <p><strong>Telefone do Interessado:</strong> <span th:text="${proposal.iTelefone}"></span></p>

                        <div th:switch="${proposal.status}">
                            <div th:case="TRADING">
                                <button>Em negociação</button>
                            </div>
                            <div th:case="ACCEPTED">
                                <button>Proposta Aceita</button>
                            </div>
                            <div th:case="REFUSED">
                                <button>Proposta Recusada</button>
                            </div>
                            <div th:case="NOT_UPDATED">
                                <button>Aguardando Atualização</button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script th:src="@{/js/general.js}"></script>
</body>

</html>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        var acceptedProposals = /*[[${acceptedProposals}]]*/ 0;
        var refusedProposals = /*[[${refusedProposals}]]*/ 0;
        var pendingProposals = /*[[${pendingProposals}]]*/ 0;

        console.log("Accepted: " + acceptedProposals);
        console.log("Refused: " + refusedProposals);
        console.log("Pending: " + pendingProposals);

        var ctx = document.getElementById('proposalChart').getContext('2d');
        var proposalChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['Aceitas', 'Recusadas', 'Pendentes'],
                datasets: [{
                    label: 'Propostas',
                    data: [acceptedProposals, refusedProposals, pendingProposals],
                    backgroundColor: ['#4caf50', '#f44336', '#ff9800'],
                    borderColor: ['#388e3c', '#d32f2f', '#f57c00'],
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    });
</script>


